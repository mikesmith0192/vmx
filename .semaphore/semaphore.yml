version: v1.0
name: Stable Web Debug Session
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Debug Session
    task:
      jobs:
        - name: Start Web Terminal
          commands:
            - sudo apt-get update && sudo apt-get install -y wget
            - echo "Installing GoTTY..."
            - 'wget "https://github.com/yudai/gotty/releases/download/v1.0.1/gotty_linux_amd64.tar.gz"'
            - tar -xvf gotty_linux_amd64.tar.gz
            - sudo mv gotty /usr/local/bin/
            - echo "Installing Cloudflare Tunnel..."
            - 'wget "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb"'
            - sudo dpkg -i cloudflared-linux-amd64.deb
            - echo "Starting web terminal server..."
            - gotty --port 8080 --permit-write bash &
            - echo "Starting Cloudflare tunnel..."
            - 'nohup cloudflared tunnel --url http://localhost:8080 > cloudflare.log 2>&1 &'
            - sleep 8
            - echo "-------------------------------------------------------------------"
            - echo "SESSION ACTIVE FOR 1 HOUR"
            - 'echo "Connect using the Web Session URL below:"'
            - echo ""
            - 'grep -o ''https://.*\.trycloudflare.com'' cloudflare.log'
            - echo ""
            - echo "-------------------------------------------------------------------"
            - sleep 3600
